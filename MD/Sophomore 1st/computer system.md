# 计算机基础
## 信息表示
数据通过电信号表示

有模拟信号（连续）和数字信号（离散）之分
### 数字信号
电平型（状态）、脉冲型（变化）
### 数据型字符的表示方法
#### 带符号数的表示
原码

    符号位：正数0，负数1
    有效位：与真值相同
    范围对称，有两个0
反码

    符号位：正数0，负数1
    有效位：正数与真值相同，负数按真值各位取反
    范围对称，有两个0
补码

    符号位：正数0，负数1
    有效位：正数与真值相同，负数按真值各位取反+1
    范围负数大一个数，只有一个0（相当与0视为正数区）
#### 定点数
无符号定点整数：正数，全数位为有效值

带符号定点整数：最高位符号，有效位表示纯整数

带符号定点小数：最高位符号，有效位表示纯小数

在带符号定点小数中，只有补码可以取到-1的下界（即负数多一个）
#### 浮点数
阶码符号位-阶码-尾数符号位-尾数

尾数规格化：

    在原码中数据位最高位为1
    在补码中数据位最高位和符号位不同（除真值-0.5补码表示为1.1）
#### IEEE短浮点数
1数符-8阶码-23尾数

数符为整个浮点数的正负

阶码采用偏移127的移码保证正数

尾数是纯定点小数（已规格化），其真值隐含个位的1
### 字符型数据的表示方法
#### ASCII码
ASCII码八位，最高位为校验位，实际编码七位

校验码分奇偶校验，原理是数二进制码中1的个数（包括校验位在内，奇校验1，偶校验0）
## 数字逻辑基础
### 逻辑代数
与门：&

或门：>=1

非门：1⚪

异或门：=1

正逻辑：1高0低；负逻辑：0高1低
### 译码器
#### 2-4
通过一个使能端控制地址——二进制转换（高电平有效）
#### 3-8译码器（以74LS138为例）
由三个使能端控制（100有效）
### 触发器
储存一位二进制信息

具有稳定状态以保存二进制数

可以输出这些状态

状态可以转换
#### RS触发器
缺陷：
    
    输出受电平控制——抗干扰能力不足
    存在约束条件——SR同0时触发器会出现不定信号，因此是不可用的
    时钟信号不存在——无法协同
#### 时钟信号CP
一种同步信号
#### 钟控RS触发器（电平型）
通过加入时钟信号输入端获得同步

时钟封锁控制门时触发器状态不变

打开时和基础触发器一致

缺陷：

    约束条件仍然存在
    存在“空翻”问题（一个周期多次反转状态）
#### 钟控D触发器
将RS双输入端优化为单个D输入端

但仍然存在空翻现象
#### 边沿（维持——阻塞）触发器
仅在时钟跳变时刻允许改变状态

不会空翻

其中边沿RS仍然存在约束条件，边沿D则相对完美
#### 集成D触发器
在边沿D触发器的基础上加入了确定初始状态的异步置位（0）和异步复位（1）端
# 计算机组成原理
## 1.概论
### 冯 · 诺依曼计算机（存储程序控制）

>二进制表示数据和指令

>存储程序方式工作

>硬件：运算器、控制器、存储器、I/O设备



特点：运算器为核心、指令串行执行

改进：并行处理、输入输出控制方式、存储器组织方式（单一>>分层）、指令系统（软硬件分界线）设计（复杂指令集x86，精简指令集arm）

### 硬件系统
#### 1.CPU（运算器+控制器）
    执行指令，产生控制信息，控制各个部件工作

*运算器*：实现各类运算

    包括ALU(算数逻辑单元)，选择器、移位器和通用寄存器组

*控制器*：产生指令（微命令）

    控制各部件操作。
    输入指令信息、状态信息、时序信息，输出微命令序列。
微命令产生：
    
    组合逻辑控制（输出只取决于输入，无反馈）
    微程序控制（微指令产生）
#### 2.存储器
存储程序与数据

    辅助存储->主存->Cache->Reg(CPU)
组成

    地址寄存器->地址译码->存储体<-->读写<-->数据寄存器
    控制线路（产生读写时序，控制读写操作）
#### 3.输入/输出设备
转换外部信息和计算机内部数据，提供人机交互

    信息→（输入）→数据→计算机→数据→（输出）→信息

### 硬件系统结构
1.总线结构（微机）系统结构以总线为基础

*总线：多部件分时共享*


1）单总线结构

2）双总线结构·以CPU为中心：一条存储，一条IO（储存和IO之间访问缓慢）

3）双总线结构·以存储器为中心

4）多级总线结构：局部总线和系统总线

2.通道结构（大型）通道代理控制外设

3.IOP（大型）IOP代理I/O处理

4.模型机结构

5.I/O接口

    系统总线<-->接口<-->外设

### 性能指标
#### 基本字长
    参加一次运算的操作数的位数
    影响计算精度、指令功能
#### 运算速度
    CPU主频和时钟频率：决定CPU内核工作速度
    MIPS：每秒百万条指令数
    FLOPS：每秒浮点运算速度
    CPI：执行指令所需时钟周期数
#### 数据通路宽度和数据传输率
    1）数据通路宽度：总线一次并行传送位数
    2）数据传送率（总线带宽）：总线每秒传送字节数
#### 存储容量
    1）主存容量：主存单元数（决定地址位数）*主存单元位数
    2）外存容量
## 2.指令系统——计算机软硬件界面
指令：

    能被CPU识别、执行的二进制代码
指令系统（指令集）：

    计算机能执行的全部指令的集合
### 指令格式
#### 基本格式
一条指令包含两方面信息：

    操作码OP：与操作有关
    地址码AD：与操作数有关
一条指令只有一条操作码，地址码0-4个
#### 指令字长
定长格式控制简单

变长格式合理利用存储空间

增加字长丰富指令功能，但占空间，取指令时间长，执行速度慢
#### 操作码结构
操作码位数决定类型多少

    定长操作码：长指令固定在指令高位
    扩展操作码：短指令操作码位置不固定，带扩展标记
    方式码：操作码每部分代表一个操作
#### 地址码结构
    显地址：在指令中显示给出地址码
    隐地址：隐含约定地址码
    地址结构：几个地址，哪些地址

四地址指令

    操作码-地址1-地址2-结果地址-下一条地址

三地址指令

    操作码-地址1-地址2-结果地址
    下一条采用隐地址（专用计数器存放）

二地址指令

    操作码-地址1-地址2
    有一个地址不再使用，结果覆盖操作数地址
    下一条仍然采用隐地址

一地址指令

    a.隐含约定目的地址（提供一操作数），双操作数
    操作码-源操作数地址
    b.单操作数，结果放回
    操作码-目的操作数地址

零地址指令

    操作码
    a.单操作数，隐含在寄存器，结果送回
    b.不需要操作数（延时/停机）


扩展

*双操作数指令的操作码部分留下一部分字节（如全1，全0）作为一操作数指令的标记（扩展），一操作数指令又可以留下一部分给零操作数指令*


### 指令寻址方式
#### 数据存储位置

    寄存器（CPU、外设接口）
    存储器（主存，如cache、外存，如硬盘）
    堆栈（主存软堆栈、CPU寄存器硬堆栈）
外设不直接连接总线，通过接口寄存 

#### 寻址方式
（1）立即寻址

    指令直接给出操作数，指令和操作数一同取出
    一般用于给出初值
    速度快，灵活性差
（2）直接寻址

    给出操作数地址（存储单元号/寄存器号）
    操作数在主存单元内（主存直接寻址）
    操作数地址→访存→操作数
    操作数在CPU内寄存器中（寄存器直接寻址）
    寄存器号→操作数
寄存器速度更快，而位数小（通过减少地址码位数减少指令长度）<br>
（3）间接寻址（操作数都在存储器）

    间接地址：操作数地址所在单元的地址
    主操作数在主存储器中。直接地址由主存单元提供

    主存间接寻址：间接地址和直接地址都在主存
    间接地址→访存→直接地址→访存→操作数（二次访存）
    寄存器间接寻址：间接地址由寄存器提供，直接地址在主存中
    寄存器号→操作数地址→访存→操作数
寄存器间接寻址减少地址码长度

    Ⅰ.自增寄存器间接寻址（后增）
    获取操作数后，寄存器值++（修改寄存器内数值）
    重复执行可访问一段连续区间
    Ⅱ.自减寄存器间接寻址（先减）
    获取操作数前，寄存器值--（修改寄存器内数值）

堆栈寻址（以向上生成为例——高地址栈底）
    
使用堆栈指针SP作为间接寻址寄存器（可隐式可显式）

    压栈：自减
    出栈：自增
（实际操作和栈匹配）

堆栈初始化：栈底（初始值）送入SP

(4)变址、基址寻址

变址寻址

    形式地址D+变址量N(来自变址寄存器号)=有效地址A
    
基址寻址

    形式地址D+基址寄存器Rb内容=有效地址A

异同：

    地址计算方法相同
    变址寻址：寄存器提供变量，指令提供基准量；面向用户
    基址寻址：寄存器提供基准量，指令提供变量；面向系统

相对寻址（浮动编址）：基址寻址的特例

    PC（程序计数器）作为基址寄存器
    操作码-地址1-PC-d(位移量)
    (PC给出的地址：一般是下一地址)+d=有效地址A

取指令会使PC移动
### 指令类型
#### 指令分类
①指令格式

②操作数寻址方式

③指令功能：

    传送指令
    I/O指令
    运算指令
    程序控制指令
    处理机控制类指令

#### 传送类指令
需要考虑：

    传送范围：寄存器之间传送（R<->R）、存储器之间传送（M<->M）、寄存器（CPU）读写存储器
    传送单位：字节、字、双字、数组等
    寻址方式

堆栈指令（传送特例）

    压栈PUSH：将数据送入堆栈顶部
    出栈POP：从堆栈顶部弹出数据
数据交换指令（非单向）

    双向数据传送，交换数据而非拷贝数据
#### I/O指令
广义传送指令，传送的一方为输入/输出设备

（1）外围设备编址

    外设单独编址（独立于主存）：编址到设备级,指令给出设备码和外设中的寄存器；编址到寄存器（地址码位数不一致），给外设寄存器分配端口地址
    外设统一编址：统一编址到寄存器级（占用主存），外设接口寄存器视作主存单元（地址码位数一致）。可使用传送指令代替I/O指令
（2）I/O指令设置

    1.设置专用IN,OUT指令：适合单独编址（设备编码-寄存器：设备编码/直接给出外设端口地址（直接/间接寻址）：端口地址编码）
    2.通用指令（隐式I/O指令）：适合统一编址（以相同指令访问储存和外设）

#### 指令系统
<font color=76875>
指令格式、指令地址结构及其简化思想（隐地址）、减少地址码长度（寄存器寻址）、四大类寻址方式（立即数、直接、间接、变址类）、指令类型
</font>

## 3.CPU子系统
CPU逻辑组成、CPU工作原理
### 模型机总体设计
#### 模型机指令系统
双操作数、单操作数、转移指令<br>格式：定长指令，16位字长

    双操作数：操作码-目的地址-源地址
    单操作数：操作码-目的地址
    转移指令：操作码-转移地址-转移条件
寻址方式：操作数在寄存器/储存器<br>模型机主存按字编址，16位，采用寄存器寻址减少地址码长度

    寄存器直接寻址：000,R
    寄存器间接寻址：001,（R）
    自减型：010，-（R）
    自增型：011，（R）+
    自增双间址：100，@(R)+
    变址/相对寻址：101，X(R),d在指令的下一个单元
    跳步：110，SKP
操作码4位，15种指令（14种编码）
#### CPU组成
寄存器、运算器、控制器、总线

寄存器：D触发器组成

    通用寄存器提供了编号以编程，暂存器则不可编程
    指令寄存器IR存放现行指令
    程序计数器PC提供下条指令地址
    程序状态字寄存器PSW有特征位（保存ALU计算特征：进位、溢出、零值、负数）和控制位（记录中断标志）
    主存接口寄存器：(不可编程)
        地址寄存器MAR：访存地址送往主存（单向）
        数据缓冲寄存器MDR：由控制命令决定传送方向（双向）
运算器：

    2个多路选择器（连接有八个输入，但只有一个输出）选择操作数来源；ALU（算术逻辑单元）由微命令控制不同运算；移位器直接传送/左右移位
控制器（微命令发生器）：

    分步、分时产生微命令（控制信号）。时序信号、I/O请求指令寄存器IR、程序状态字寄存器PSW输入
总线：

    CPU内总线（单向）：运算器通过移位器将输出送入总线，寄存器分别接受输入
    系统总线：连接主存和外设接口
时序系统：

    产生时序信号的部件
    信号作为分布执行的标志 
    信号类型：机器周期（工作周期）（一般是时钟周期的倍数）、时钟周期（固定，作为计算器参数）、脉冲（定时操作）
>由振荡器发出基准脉冲，分频器将其分为工作脉冲（上、下边沿触发触发器），工作脉冲之间的时间称为时钟周期（节拍）
#### 数据通路结构
传送路径：指令执行过程就是信息传送

    指令信息：主存到指令寄存器
    地址信息：指令、数据地址(单向读主存)
    数据信息：寄存器到寄存器、寄存器和主存/接口互通、主存到主存、主存外设互通（不经过CPU，高速）

- 取指令的地址：PC→选择器→ALU→移位器→内总线→MAR
- 同时修改PC，生成后继指令地址：PC→A→ALU（++）→移位器→PC

指令信息：

    主存→数据总线DB→指令寄存器IR
操作数地址：

    按寻址获得地址送入地址寄存器MAR，再送入总线
1. 寄存器间址：寄存器R-选择器A/B-ALU-移位-内总线-MAR
2. 自减型：寻址前，R-A/B-ALU(--)-移位-内总线-R
3. 自增型：寻址后，R-A/B-ALU(++)-移位-内总线-R
4. 自增双间址：<br>R-A/B-ALU-移位器-内总线-MAR，MAR访问主存，主存读出；<br>寄存器自加：R-A/B-ALU(++)-移位-内总线-R;<br>主存-DB-缓冲寄存器MDR-B-ALU-移位-内总线-暂存器-A/B-ALU-移位器-内总线-MAR
5. 变址寻址：根据PC所指访问形式地址，再与固有R相加即可

    PC-A-ALU-移位器-MAR<br>M-DB-MDR-B-ALU-移位器-C<br>PC-A-ALU(++)-移位器-PC<br>选择器-ALU-移位器-MDR
数据信息传送：
1. 寄存器→寄存器：R-A/B-ALU-移位器-Bus-newR
2. 寄存器→主存：Bus-MDR-DB-主存(同步置入)
3. 主存→寄存器：M-DB-MDR-B-ALU-移位器-Bus-R(异步置入)
4. 主存→主存：M-DB-MDR-B-ALU-移位器-内总线-暂存C
5. 寄存器→外设（统一编址）：与寄存器→主存无异
6. 外设（统一编址）→寄存器：与主存→寄存器无异
#### 时序控制
同步控制：

    CPU提供统一时序信号，各项操作同步于统一的时序信号。
    一个时钟周期（长度固定）完成一步操作。
    控制简单但时间不一定合理：
        前一步即使在周期内完成，下一步也不会直接开始，而是等待下一周期
>结果入寄存器需要严格同步打入脉冲

异步控制：

    根据实际所需要的时间调配
    采取应答方式衔接操作和信息交换
    应答控制复杂
CPU内或设备内部普遍采用同步控制<br>系统总线由于各设备速度差异较大一般采用异步控制<br>而同步扩展方式则是以同步思想为基础（时钟周期为基础），引入异步应答

一般来说速度差得少（CPU内部）使用同步；速度差得多（CPU和主存等外设）使用异步
#### 小结
<font color=42ff4>
模型机指令格式、寻址方式、指令类型<br>模型机CPU部件和连接<br>数据通路结构、信息传送路径<br>同步、异步控制
</font>

### 运算部件
#### 一位加法单元
输入：本位加数A、B，低位进位C<br>输出：本位和、本位进位

    本位：A异或B异或C
    进位：(A与B)+（A异或B）与C
        A与B:A、B均为1时必然进位
        （A异或B）与C：A、B有一个1，且C进位1
#### 串行加法器（自己捅自己）
一个全加器，一个移位寄存器（从低到高提供操作数，同时存入新值），一个一般寄存器（另一个操作数），一个触发器（暂存进位）
#### 并行加法器（加法器蜈蚣）
n位全加器实现，通过进位链（串行/并行）传递进位

    进位产生函数G:A与B  
    进位传递函数P:A异或B
    （可短路运算）
串行进位：进位信号依赖于低级进位（进位蜈蚣）
$$
C_1=G_1+P_1C_0
$$
并行进位：各级进位信号同时形成
$$
C_2=G_2+P_2G_1+P_2P_1C_0
$$
只需要各位的GP即可使得进位同时产生<br>高位全加器需要更多的输入，结构复杂

分组进位：组内并行，组间串行/并行<br>折中了复杂度和速度

#### ALU（算术逻辑单元）
以一位ALU为例：

    在全加器的基础上增加控制门M控制输入是做算术还是逻辑运算
    输入选择器：一对与或非门(包括一对控制信号输入)——多功能的由来
    输出运算结果和标志位
    一对控制信号实现工作方式16种，M再控制逻辑还是算术共32种运算
    ps:+指逻辑或
#### 运算器组织
多路选择器（独立寄存器结构）/暂存器（小型存储器结构）向ALU提供操作数<br>寄存器组结构：独立寄存器/小型存储器（每个单元当作一个寄存器使用）
### 运算方法
#### 定点加法
补码加减运算规则

    操作数用补码表示，符号位和有效位一起，得到也为补码表示
    即  X补+Y补=(X+Y)补
        X补-Y补=(X-Y)补=X补+(-Y)补
变补（求补码相反数）

    各位变反+1（实质是用0减）
运算结果溢出判断

    溢出是指两数相加绝对值超出可表示范围
    同号容易产生溢出
判断逻辑（硬件）

    正数相加得到负数/负数相加得到正数：溢出
    符号位进位和与进位不同：溢出
    双符号位判断：结果符号取决于第一符号位；01正溢，10负溢
#### 定点乘法
符号位：原码和补码操作不同<br>常规加法器：n位乘法转成n次累加、移位<br>阵列乘法器：多个部分积同时相加
<br>*原码一位乘法*

    取两个操作数绝对值相乘，每步处理一位乘法
    设置ABC三个寄存器
    A：双符号位形式的部分累加和，初值0
    B：双符号位的被乘数绝对值
    C：乘数有效位，乘一位丢一位
    C为1对A加入B;C为0对A加0，A右移末位拼入C，C右移丢弃末位
##### 移位
算术移位：

    单符号位保留符号位
    双符号位保留最高符号位
### 控制器
#### 组合逻辑控制器
通过组合逻辑电路产生微命令

被状态寄存器PSW、时序系统等影响

CPU依靠时间标志使指令分步工作

拥有三级时序：工作周期——时钟周期——工作脉冲
#### 时序系统
>时序信号可以判定取值种类（指令/数据）<br>即按时间判断指令种类

工作周期：指令执行以*取指令FT——取源数ST——取目的地址DT——执行ET*作为一个工作周期<br>只有首尾必有
IO传送以*DMA周期DMAT——中断周期IT*为一个工作周期
    
    取指令周期：
        从存储器取指令送IR(指令寄存器)，并修改PC(程序计数器)
    源周期：（寄存器寻址不需要）
        按寻址方式形成源操作数地址，从主存读取操作数送入暂存器C
    目的周期：（寄存器寻址不需要）
        形成目的地址送MAR，非传送指令需要操作数送暂存器D
    执行周期：
        根据操作码执行具体操作，并将后续指令地址(即PC值)送MAR
    DMA周期：
        响应DMA请求，实现主存和外设的数据直传
    中断周期:
        获取中断服务程序并转到中断服务
控制工作周期的切换：状态触发器

    0->1 工作周期开始
    1->0 工作周期结束
同一时间只有一个工作周期状态为1，用来指明当前工作周期

转换示意：

    ET后
    if DMA
        into DMAT
    else if I
        into IT
    else
        end

时钟周期（节拍）：
>一个工作周期可以分为多次节拍

    在一次时钟周期中，可执行
        一次读主存，并传送读到的数据；
        一次内部通路传送；
        一次写主存
时钟周期计数：第一节拍令T为0；每开始一个新节拍T++；结束清零

工作脉冲：
>在每个时钟周期结尾时安排一个工作脉冲，作为各种同步脉冲的来源
#### 指令流程和时间表
指令流程

    简化掉路径，化简为起点——终点
    如寄存器传送需要过ALU和内总线，省略不记
操作时间表

    微命令序列（可以是电位型和脉冲型）

    内部数据通路操作指令相关
        ALU输入选择：Ri->A
            Ri可以是寄存器、暂存器、程序计数器、堆栈指针
        ALU功能选择：M
        移位器选择：DM直传，SL左移，SR右移
        结果分配：CP+存储名字
            如CPR0,CPC,CPMAR等

    访问主存相关
        读主存：
            EMAR（地址使能）
            R（读存储器）
            SMDR（置入MDR）
            SIR（置入IR）
        写主存：
            EMAR
            W（写存储器）
        时序切换：
            CPXT（时钟周期切换）
取指周期FT

    1. 进入方式及条件
    （1）由S端异步置入（上电/复位初始化时）
    （2）由D端同步打入（运算过程：正常执行/DMA周期后/IT周期后）
    2.取指流程FT0
    M->IR，PC+1->PC
    3.操作时间表
    EMAR，R，SIR，PC->A，M，DM，CPPC

    源操作数寄存器寻址则不需要进入ST(CPST)
    目的操作数寄存器寻址则不需要进入DT(CPDT)
    都为寄存器寻址则直接进入ET(CPET)
传送类指令

    各工作周期的指令流程都与操作数寻址方式有关
    只需得到地址送入MAR
eg. MOV R0, R1

    FT0:M->IR,PC+1=PC
    ET0:R1->R0
    ET1:PC->MAR
eg. MOV (R0), X(R1)
    
    FT0:M->IR，PC+1=PC
    ST0:PC->MAR
    ST1:M->MDR->C
    ST2:PC+1=PC
    ST3:C+R1=MAR
    ST4:M->MDR->C
    DT0:R0->MAR
    ET0:C->MDR
    ET1:MDR->M
    ET2:PC->MAR
微命令流程：

    节拍完工作周期未完，则T+1（电平）,CPT（脉冲）
    节拍完转周期，则1—>XT（电平）,CPXT（脉冲）,CPT（脉冲）

组合逻辑控制 

    信号产生速度快
    但 设计不规整、不宜修改或扩展
#### 微程序控制器
微命令控制微操作，组成微指令<br>微指令集成微程序，在微指令周期（通常为一个时钟周期）内执行

微命令是开关门电路

微指令是电平型和脉冲型
控制思想

    指令寄存器IR输入指令代码
    状态寄存器PSW输入运行状态
    进入微地址形成电路（形成下一条微指令地址）
    输出至微地址寄存器μAR（存放地址）
    输出地址至控制存储器CM找指令（存放微程序，位于CPU内部，只读）
    微指令寄存器μIR读取CM微指令
        包括
            微操作控制字段（产生微命令）
            顺序控制字段（产生后续地址）

    由译码器翻译为微命令序列
时序系统

    脉冲上升期：微指令入μIR
    高电平期：控制具体操作
    脉冲下降期：结果打入、后续微地址打入μAR
    低电平期：读取后续指令

指令格式：按通路操作分段、互斥操作在同一字段

    A选择-B选择-ALU功能选择-初始进位-移位器选择-内总线输出分配-访问存储控制(EMAR R W)-辅助操作(ST)-顺序控制字段
### CPU设计实例——MIPS32结构
#### MIPS指令架构
+ 存储器字节编址
+ 32个CPU寄存器，每个寄存器宽度32位
  + 0寄存器R0
  + 汇编专用寄存器R1
  + 表达式返回值R2R3
  + 函数调用参数R4~R7
  + 临时变量R8~R15、R24R25
  + 非临时变量R16~R23
  + 操作系统专用R26R27
  + 全局指针R28
  + 堆栈指针R29
  + 帧指针R30
  + 返回地址R31
+ 精简指令集——包含运算、访存、转移等基本指令
  + 指令固定字长32位，寄存器型寻址，指令给出寄存器号
  + R型指令（寄存）：6位操作码，3个操作数各5位，5位常数，5位功能

        操作码全0
        1、2源操作数、3保存结果
        常数移位
        功能码表功能
    
        包括
        加减 与或异或 比较——rs小置1，否则置0（三寄存器操作数）
        逻辑左右移位，算术右移（二寄存器操作数，一位移量）
        寄存器跳转，寄存器值送PC（一寄存器）
  + I型指令（立即）：6位操作码，2个操作数各5位，16位立即数

        标志操作功能
        1源操作数
        2保存结果
        立即数为第二源操作数

        包括
        立即数加（需要扩展） 与或异或（无需扩展）
        读数据、存数据（基址寻址访问存储器，写入寄存器或由寄存器写入）
        数位设置
        条件转移（立即数用于计算PC相对寻址）
  + J型指令（转移）：6位操作码，26位转移地址

        标志操作功能
        转移目标地址的偏移量

        包括
        无条件跳转（伪寻址）
        子程序调用（返回地址保存至固定寄存器）
##### 寻址方式
通过op和func（R型）字段给出

立即寻址I

    addi（操作码） s1（目的）,s2（源） 10（立即数）
        ——汇编顺序并不对应机器码
    将s2+10的值送到s1（10是16位需要扩展到32位计算）
寄存器直接寻址R

    op rs rt rd () func
基址寻址（基址+立即数组成操作数地址）I

    op rs（基址） rt imm（立即数）
    rs+imm获得一源操作数地址
    立即数扩展（补码）：正数高位补0，负数高位补1
PC相对寻址：（隐含PC提供地址）I

    op rs rt imm
    PC+imm（扩展并左移2位/乘4）（标准是这么说的）
伪直接寻址：J

    op address
    PC给出高四位和address的26位左移两位共28位拼接得到32位地址访存得到指令
#### 基本组成部件
##### CPU存储
寄存器组：32个32位寄存器


    在寄存器组/堆中，一个组是一个独立单元（即不存在独立寄存器端口）
    具有Ra Rb端口接收地址码，将读到的值由A B端口送出
    具有Data端口接收写数据，由Rw端口接收地址
    写操作受到Wn端口信号和Clock时钟端口控制
数据存储器：32位地址线和32位数据线

    写数据
        存在MemWrite信号
        和时钟信号Clock控制写入
    读数据（即存储器输出）
        存在MemRead信号控制读出
指令存储器：32位地址线

    读入PC提供的地址
    随Clock输出
特殊功能寄存器：32位输入和输出

    程序计数器PC
    指令寄存器IR
    标志寄存器FR（类似状态字寄存器PSW）

    由写使能和Clock控制
##### 数据预处理
预处理操作：

位数扩展（带符号/无符号）

左移两位

数位拼接

数位扩展器Extender

    负责16->32位扩展
    包括数值扩展（补码规则补）和逻辑扩展（直接补0）
左移两位器

    超过32位左移丢弃最高两位，末尾补零
    不超过直接低位补零
二路拼接器

    拼接PC的4位和address的28位
##### 运算部件
一个单功能加法器Adder和多功能算术逻辑运算单元ALU

Adder做PC固定自加

ALU做其他复杂运算
##### 数据通路选择部件
多路选择器MUX

    由n位选通信号控制
##### 控制器（难以直接使用现成部件）
#### 单周期MIPS处理器
单周期即指令固定在一个时钟周期内完成

    时间效率低，最长指令时间决定了时钟周期宽度
    功能部件不能并行，冗余度大
多周期即指令分散在多个时钟周期内完成

    时间效率高，最长单步时间决定了时钟周期宽度
    功能部件共享，冗余度低
单周期数据通路设计

R I整合，和J整合，和取指整合

## 4.存储子系统
### 概述
存放大量程序和数据
>基本要求：容量大、速度快、成本低
#### 存储子系统的层次结构
分层结构：高速缓存Cache——内存——外存，是解决存储器和CPU速度不匹配产生的“瓶颈”问题的方法之一

高速缓存Cache：

    和CPU、内存都可以交换

    存放最急需的数据作为主存中活跃信息的副本（保存副本而不是不同的东西）

    速度最快，容量最小，成本高

    有效缓解访存瓶颈问题
主存储器（内存）：

    CPU可以编程访问，存放当前CPU需要访问的程序和数据

    存储速度较快，容量比较有限

    随机访问（指定单元编号可以以相等时间访问）
    具有一定的存储容量（需要存储当前运行程序）
外部存储：

    需要联系计算机保存，存放暂时不需要的大量程序和数据

    存储速度较慢，容量很大，成本低

    CPU无法直接访问，只有进入内存才可运行
#### 存储器按存储介质分类
半导体存储器——双极型（TTL,ECL）/MOS型（静态、动态）

    数据易失

磁表面存储器（机械硬盘）

    利用不同方向的磁化信息表示信息
    容量大、速度慢（外存）
    非破坏性读出、长期保存信息
光盘存储器

    利用光斑有无表示信息
    容量大、非破坏性读出、长期保存、速度慢
    有只读型、写入式（初始写一次）、可擦除/重写型
    作脱机外存
#### 存储器按存储方式分类
随机访问存储器(RAM)：作主存、高速缓存

    可按地址随机访问任一存储单元
    访问各单元所需时间相同
>速度指标

    存取时间：启动读写命令到完成所需的时间
    存取周期：连续两次独立访存需要的时间间隔（稍长于存取时间）
>读写特性分类

    RAM(SDR、DDR)：断电内容丢失
    ROM（只读）：
        固存：不能编程
        PROM：一次编程
        EPROM：多次编程、紫外线擦除
        EEPRAM：多次编程、电擦除
        闪存Flash Memory：快擦可重写，非易失
顺序访问存储器(SAM)：磁带
    
    信息按顺序存放，访问时间和信息存放位置有关
    两步操作：等待（将需要访问的区域移动至磁头处）、读/写
>速度指标

    平均等待时间
    数据传输率
直接访问存储器(DAM)：机械硬盘

    直接指向一个小区域，再在小区域里顺序查找
    磁头径向移动，磁盘转动
    三步操作：定位（寻道）、等待（旋转）、读/写
>速度指标

    平均定位时间
    平均等待时间
    数据传输率
### 存储原理（半导体）
存储元：表示一位二进制，具有记忆功能
存储单元：若干存储元构成一个存储单元
#### 静态存储SRAM：不需刷新
六管单元电路  存储元：依靠双稳态电路交叉反馈储存信息

存储芯片：

以SRAM芯片2114（1k×4位）为例

    地址端A9~A0（入）
    数据端D3~D0（入/出）
    控制端：片选CS（0选中）、写使能WE（0写1读）
以SRAM芯片6264（8k×8位）为例

    地址线：A0~A12
    数据线：D0~D7
    片选：CE/CS
    读：OE
    写；WE
    空端：写

#### 动态存储DRAM：需定期刷新
依靠电容存储电荷存储信息

由于电容存在泄露，存1电容需要重新充电维持存储

四管单元电路存储元

存储芯片：

    以2164为例

        地址端：A0~A7
        数据端：一出一入
        控制端包括写使能、行选、列选
### 主存储器组织
#### 主存储器逻辑设计
单个存储芯片不能满足主存需求，需要多个存储芯片

逻辑设计即如何分配地址码来选择芯片（片选逻辑）和单元（地址分配）

主要问题:

    确定总容量：字数（存储单元数）×位数（每单元存储数/按xx编址）
    确定存储芯片（可能存在位数和字数的扩展问题）（大容量芯片当低端））
        字扩展：增加单元数量
        位扩展：增加单元大小

>高位片选，低位地址分配<br>n bit大小需要$2^n$位地址寻址（单芯片位置直接给出）<br>在此基础上增加片选位（负责用二进制序号区别芯片）（拼凑位数的多个芯片片选位一样、位扩展将位数合并）

连接方式

    扩展位数：位扩展地址线分别连、字扩展连同一地址
    连接控制（地址分配）：拼凑位数的芯片统一控制
    片选逻辑形成片选信号（对字扩展用芯片分别控制，位扩展用打包控制）
片选地址译码：

    将片选的地址信号转换为确定的输出信号（高/低电平）输入到片选端
全译码：使用全部地址信号——高位译码、低位地址

部分译码：高位使用一部分作为片选译码，地址空间有重复

线译码：部分译码的特例，一位片选

总结：

    计算最大容量芯片所需地址位数作为地址线
    四坨芯片两位片选，八坨三位片选（最终输入1为片选到）

    连接时
    数据总线（位数是芯片位数，扩展了给扩展后位数）连CPU
    地址总线（位数是自身单元数量，小芯片算自己的而不是最大芯片的位数）连CPU
    片选逻辑连芯片（保证逻辑输入后最终输入1到被选芯片，小芯片往往需要多一位片选因为高地址空缺）

#### 动态储存器刷新
刷新定义和原因

    电容会泄放电容，需要定期补充电荷
    刷新并非重写，不是因为破坏性读入导致的
最大刷新间隔

    模型机2s
刷新法（芯片几行刷几次）

    按行读：刷新一行的时间就是刷新周期
    刷新一块芯片的时间由芯片矩阵行数决定
    对主存的访问：CPU访存，有包含行地址和列地址，随机访问
    动态刷新由刷新地址计数器提供行地址，定时刷新
刷新周期安排模式

    集中刷新：在刷新周期内用一段连续时间对存储进行刷新——先做完再库库刷
        实时要求不高，有多余刷新
    分散刷新：即把每个工作周期分成存取和刷新两部分——写一下刷一行
        低速系统适用，使系统存取时间延长
    异步刷新：各刷新周期分散在2ms内，每隔一段时间刷新一行——和读写无强联系，单纯的隔一会刷一行
        大多数计算机使用，不会有明显读写停顿、也不会延长系统的存取周期

    
#### 主存储器校验
冗余检验思想：

    校验码：将有效编码和校验码一起按校验规律编码

奇偶校验：
    
    按1的个数进行校验（这里1的个数包括校验码里的）
    其中奇校验校验位为1，偶校验校验位为0
    奇数个变化可以测出、偶数个变化不能测出
## 5.IO子系统
### 概述
外设通过I/O接口连接到系统总线上
#### 总线
一组能为多个部件分时共享的信息传送线路
>特点：分时、共享（同时发送信号会导致冲突）

    发送部件通过三态门控制实现分时发送信息
实体构成：

    一组传送线及其控制逻辑（包括CPU内控制逻辑和总线控制器）
总线位数是指一次可以传输的信息位数

#### 总线分类
按传输信息类型：

    数据总线：传输数据信号
    地址总线（决定访存空间）：传输地址信号
    控制总线：传输控制信号
        （分时复用：在某些时刻共享数据和地址总线）
按功能层次：
        
    片内总线：CPU内部互连（ALU、寄存器等）
    局部总线：CPU和外围控制芯片互连（ROM、RAM等）
        系统总线：计算机内部功能部件之间（存储扩展、图形处理器、I/O处理器等）
    外总线：计算机系统之间（通信总线）
按时序控制方式：

    同步总线：统一时序控制总线传送操作。固定个时钟周期内完成数据传送、同步脉冲打入
    异步总线：总线周期由实际需要决定，以异步应答控制总线传送
    扩展同步总线：允许总线周期由不定个时钟周期组成
按数据传送格式：

    并行总线：同时传送各位信息
    串行总线：分时逐位传送各位信息
>CPU内总线：同步、并行<br>系统总线：同步/异步/扩展同步、并行<br>外总线：异步、并行/串行

异步控制中的应答：
    
    主设备向CPU提出请求
    CPU批准
    请求信号撤销
    批准信号撤销
    总线权切换（CPU将总线交给主设备）
    主设备向从设备发起主同步信号（开始传送信息）
    从设备向主设备发起从同步信号（传送完成）
    主同步信号撤销
    从同步信号撤销

    其中主设备拥有总线控制权（不论是接收还是发送信息）
三种异步应答：

    不互锁：请求和应答信号撤销时间定时。
    半互锁：请求信号需要接收到应答成功再撤销，应答信号定时撤销。
    全互锁：请求信号需要接收到应答成功再撤销，应答信号需要发现请求信号撤销再撤销
三个周期:

    时钟周期：CPU一次操作/一次数据传送
    总线周期：经过总线的一次数据传送（访存）（模型机的一个总线周期只有一个时钟周期，但一般PC有好几个时钟周期）
    工作周期：指令周期的一个阶段，可包含多个总线周期
#### 总线仲裁
集中式仲裁：总线控制集中在中央仲裁器

链式查询（按固定逻辑顺序匹配）：

    按固定优先级进行授权查询，将设备从逻辑上排成一串
    串行地对各个设备查询是否有提出请求，对第一个有请求的设备进行匹配，中断授权信号，并发出总线忙信号
计时器定时查询（标号符合匹配）：

    仲裁器收到请求时会生成一个计数器初值
    定时查询计数会同时发给所有设备，计数和设备编号一致则中止查询，匹配成功，并发出总线忙信号
    优先级相对灵活
独立请求：

    各设备有专用请求线进行请求，并通过专用授权线接收总线批准。通过默认优先级进行授权，获得授权的设备发总线忙信号

分布式仲裁：各设备有仲裁电路

    自行和正在使用总线的设备优先级进行比较
#### 总线标准
物理结构：接头大小、引脚数量、相对位置等

功能特性：每一个信号线的功能

电气特性：信号传送方向、信号驱动能力、抗干扰能力、正负逻辑等

时间特性：信号有效时机、持续时间等
#### 接口功能
I/O接口是主机和外设的交接部分

主要功能：

    寻址：接收CPU地址码、选择接口寄存器

    数据缓冲：匹配主机和外设的速度、缓冲大小和数据量有关

    预处理：包括串并格式转换（串口）、数据通路宽度转换（并口）、电平转换

    控制逻辑：解释CPU命令，产生相应操作交给设备；将设备状态通过总线传给CPU
#### 接口分类
按数据传送格式：

    并行接口：对总线和外设均采用并行传送（位数可能不同，因此需要数据通路宽度转换），数据各位同时传送
    串行接口：对总线并行、对外设串行，数据逐位分时传送
按时序控制方式：

    同步接口：和同步总线
    异步接口：和异步总线
按I/O传送控制方式：

    直接程序传送接口
    中断接口
    DMA接口
#### I/O控制方式
主机和外设进行信息交换时有三个问题

    CPU等待外设启动还是并行执行程序（此时外设正在工作）？
        在直接传送中需要等待，而在中断、DMA方式中并行

    外设准备好（即数据送到接口/接口数据被取走）后如何通知CPU？
        中断方式通过中断信号
        DMA方式通过DMA请求
    I/O操作通过硬件指令还是软件？
        直接传送和中断通过软件
        DMA方式通过硬件
### *直接传送方式及其接口*
外设准备期间，CPU需要等待——称作直接传送方式
#### 无条件直接传送
假设外设总是准备好的（可以读/写操作）

    输入->输入缓冲器->DB
    （地址、控制进译码有效，读命令，片选有效）

    DB->输出缓冲器->输出
    （地址、控制进译码有效，写命令，片选有效）
控制简单、接口简单，但由于假设不总是成立，应用受限
#### 条件传送（程序查询式）
需求更复杂的接口

    系统总线<-->地址、IOR、IOW进译码，命令/状态寄存，数据缓冲寄存<-->外设

    通过状态寄存器判断是否准备好，双方准备好后会修改状态寄存器状态
    此时CPU查询等待，直到设备准备好
1. 外设状态：<br>空闲（调用前），工作（送数据/取数据），结束（完成工作）。<br>通过状态字00，01，10表示
2. 输入流程：<br>启动外设 -> 读设备状态（原地等待）->（准备好了）从接口读数据（多次输入则多次（读状态->读数据）循环） -> 结束<br>CPU读状态：状态缓存器地址通过地址总线输入，通过地址译码器找到状态；返回信息输入数据总线回到CPU<br>CPU读数据则是查询数据缓冲器地址
3. 输出流程：<br>启动外设 -> 读设备状态（原地等待）->（准备好了）送数据到接口（多次输出则多次（读状态->输数据）循环） -> 结束<br>CPU写数据：将数据通过DB送到锁存器（作为输出缓冲）

CPU并行程度低，不能响应外部随机请求

控制简单、硬件开销小

对CPU效率要求不高可使用，调试错误可使用
### 中断方式及其接口（复杂低速）
为了并行中能响应请求，处理随机事件而生

随机事件包括

    随机事态：按键、掉电等
    外设启动完成的请求：调用打印机
    随机插入事态：软中断等
#### 中断基本概念
1. 定义CPU暂时中止现行程序、为某个随机事件服务的中断处理程序

        当前程序 -> 响应 -> 中断处理程序-> 返回断点 -> 继续原程序
        中断请求 /\
                 |
    需要保存断点信息以返回

2. 中断本质：**程序切换**

        保存断点（进入中断程序之前）：即将返回地址（PC的值）压栈
        保护现场（中断服务处理前）：保存一些寄存器的值（软现场）
        恢复现场（中断服务处理后）
    并非一收到信息就切换，而是等待当前指令完成，保证程序完整性

    程序切换需要时间和空间的开销

    适合中低速I/O操作和随机事件

    中断和调用子程序的过程是相同的，但中断服务不是编码调用的（程序里没有，发生点不定）

3. 中断分类：

        硬件中断：硬件请求信号引发（输入、输出设备等）
        软中断：软中断指令引发

        内中断：中断源来自主机内部。除法错、溢出、软中断等
        外中断：中断源来自主机外部。通常也是硬件中断

        可屏蔽中断：可以通过关键字（接口）屏蔽；且关中断状态（CPU）时可以不响应（外部设备一般是可屏蔽中断）
        非屏蔽中断：不受屏蔽字影响；开关中断也不影响
        通过程序状态字寄存器PSW中IF中断允许判定开/关中断状态

        向量中断：硬件提供中断服务入口（效率高）
        非向量中断：软件提供中断服务入口

4. 典型中断应用：

        管理中低速I/O操作（高速和CPU速度差距小，浪费时间不如中低速多）
        处理故障
        实时处理而非批量处理
        人机对话
5. 中断系统软硬件组织
        
        中断硬件：I/O接口、CPU响应逻辑
        中断软件：中断请求源、中断服务程序、中断向量表
     1. 中断请求源（通过中断号区分）：*外部硬件中断源（IREQ0-IREQ7，可扩展）、内部硬件中断源（溢出、校验错等）、软中断INT n*
     2. 中断服务程序：*响应中断请求后调用的程序（什么中断对什么程序），实现处理中断事件*
     3. 中断向量表（中断系统的软硬件界面）：<br>*中断向量是中断服务程序的入口地址（有的也有状态字），为了快速找到中断源对应的中断服务程序，则按照一定规则在连续区域内存放各中断向量，称作中断向量表<br>向量地址是访问中断向量需要的存储单元地址<br>有专用区（主机中断请求）、系统保留区、用户扩展区*
#### 中断全过程（以外中断为例）
中断请求和传递 -> 中断判优 -> 中断响应 -> 中断服务处理 -> 中断返回

1. 中断请求信号——来自外部设备：
   1. 外设工作完成（接口“完成”标志1）
   2. 且CPU允许请求（中断允许标志1表示开中断）
   3. 且同步脉冲CP到来，则产生请求信号
2. 请求信号传递——CPU引脚接收：
   1. 可以使用单独请求线，但CPU需要多个不同引脚，扩展性差；
   2. 使用公共请求线，但不同外设提出请求时，需要判定机制判定信号来源和优先级
   3. 可以使用二维结构，使用多条公共请求线，每条线上挂接同优先级外设
   4. 可以使用混合结构，部分单独请求，部分公共请求
3. 中断判优：
   1. 不同事件的优先顺序：<br>故障中断 > DMA > 外中断（输入 > 输出）<br>
   2. 现行程序和外部请求的优先级高低：<br>通过PSW中的中断允许IF标志开关决定（即开/关中断）<br>通过PSW中的优先级字段判定
   3. 不同外设之间优先级高低：
      1. 软件判优（可修改的）：即程序查询优先级。通过端口的顺序查询实现逻辑上的查询优先
      2. 硬件判优（高速）：在独立请求并行判优（独立请求线）和链式优先排队逻辑（公共请求线）中，优先请求会通过电路门阻止低等请求发送
      3. 专用芯片（中断控制器）：以8259为例<br>*支持八个中断源（IR0~IR7）<br>拥有八根数据线（D0~D7）可以被CPU使用进行读写<br>地址线A0，片选信号CS非，读写信号RD非、WR非<br>传输方向SP/EN非、级联CAS<br>INT发出中断信号，INTA非接收中断响应*

8259中断控制器

    请求信号IRQ通过IR接口输入中断请求寄存器IRR
    中断屏蔽寄存器IMR可以通过设置请求位为1屏蔽某个请求
    中断服务寄存器ISR记录当前响应中断源（正在进行中断服务）
    优先级裁决器会判定是否产生新的中断信号：
        被屏蔽后的请求优先级低于现有则不发INT，反之（且允许中断程序中断中断程序）发INT
        发INT后，CPU响应发中断响应到INT非
        接收信号后通过数据线发中断号
        CPU查中断向量表获取中断程序入口地址
4. 中断响应：
      1. 有请求，未被屏蔽
   1. 响应条件：
      1. CPU开中断
      2. 没有更高优先级的事件
      3. 上一条指令不是停机
      4. 必须在上一条指令执行完成后响应
   2. 响应过程：
      1. 现行指令最后一个节拍响应INTR，向中断控制器发响应信号INTA
      2. 安排一个中断周期（中断周期并不执行中断服务，而是进行保存断点、获取中断服务地址等过渡操作）
   3. IT周期流程：
      1. CPU关中断
      2. 保存断点（PC值）到堆栈
      3. 获取中断服务程序入口送PC（需读存储器）
      4. 转中断服务程序FT
   4. 入口地址获取：
      1. 向量中断（硬件）：硬件通过中断类型号产生向量地址
      2. 非向量中断（软件）：转中断查询程序软件查询中断源
5. 中断处理（中断服务程序执行）：
   1. 单级中断：即中断程序不允许被中断
      1. 保护现场（中断程序也需要使用寄存器，因此主程序寄存器值压栈保存，即软件现场保存；有时也需要保存PSW这样的硬件现场）
      2. 具体服务处理（中断服务程序）
      3. 恢复现场
      4. 开中断，返回
   2. 多重中断：允许中断嵌套
      1. 保护现场（关中断状态，即IF置0）
      2. 送屏蔽字至IMR（禁止低优先级中断，即低优先级全部置1），开中断
      3. 具体服务处理
      4. 关中断，恢复现场和原屏蔽字
      5. 开中断，返回
#### 中断接口
1. 组成（寄存器级）

        地址线->端口地址译码（对接口寻址）->（选择端口寄存器）
        数据线->命令字寄存器（转换CPU命令）->命令
        数据线<-状态字寄存器（反映设备和接口状态）<-状态
        数据线<->数据缓冲器（数据通路）<->数据
        ---
         控制逻辑（产生请求信号、电平转换、串并转换、中断源扩展等）
            ||IRQ
            \/
        中断控制器（接受请求、判优、送中断请求、接中断响应、送中断号）
2. 工作过程（外中断）
   1. 初始化：设置工作方式、送屏蔽字、送中断号（高位）
   2. 发启动命令（送命令字）启动设备
   3. 设备完成工作，请求中断当前程序（此时CPU在并行工作）
   4. 中断控制器进行中断判优，结果INT送出中断信号，形成中断号
   5. CPU响应，返回INTA非（发两次）中断响应
   6. 中断控制器送中断号
   7. CPU执行中断隐指令，进入中断服务
#### 中断小结
中断概念、随机性、中断分类、实质（程序切换）

在中断方式中，CPU能够在等待外设时并行工作

外中断全流程

向量、非向量中断的中断程序入口地址的获取方式

单级中断、多重中断

优先级判定（屏蔽字）
### DMA方式及其接口（简单高速）
直接传送和中断方式都是通过CPU指令进行数据传送，通过**软件**实现<br>而DMA是直接硬件实现
#### DMA基本概念
Direct Memory Access：直接存储器访问

    通过硬件实现主存和外设数据直接交换即数据传送不需要CPU

实质：**总线权切换**（传送依靠系统总线）

特点：随机、并行。用于简单批量高速数据传送

典型应用：磁盘调用、动态存储器刷新、高速数据采集

##### 传输方式：
1. 单字传输（周期窃取）：提出一次DMA请求获批后，占用一个总线周期传输一个字节/一个字。不会造成长时间死区
2. 成组传输：每次批准连续占用若干总线周期进行批量传输

DMA响应流程：

    在一条指令末尾响应DMA请求：
        进入DMA周期（1->DMAT，CPDMAT，响应）
        CPU放弃总线权，由DMA控制器接管
        读存储器->写接口/读接口->写存储器
        完成后DMA控制器放弃主线权，转下一条指令
#### DMA控制器和接口
硬件设置：

    CPU：响应逻辑

    DMA控制器：
        控制、状态逻辑——传送方向
        地址计数器——主存地址
        交换量计数器——传送次数

    外设接口：
        DMA请求/中断请求
        数据缓冲器——暂存数据
        外设寻址逻辑——提供外设地址
##### DMA控制器类型
单路型控制器：一个DMA控制器连接一个接口，接口通过控制器接入系统总线

选择型控制器：一个DMA控制器可以连接多个外部设备，外设们通过一条I/O总线连接到DMA控制器。同时只能传送一个外设

多路型控制器:DMA控制器独立于接口，接口直接连接系统总线。需要两级请求一发CPU一发控制器

DMA控制器功能：

    初始化：接收初始化信息（传送方向、主存首地址、交换量……）
    传送前：接收外设发来的DMA请求、判优，并向CPU申请总线权
    传送中：接管总线权、发地址和读写命令

接口功能：

    初始化：接收初始化信息（外设寻址）
    传送前：向DMA控制器发送请求
    传送中：传送数据
#### DMA传输过程——以磁盘为例
磁盘拥有**磁盘适配器**和**磁盘驱动器**
1. CPU给磁盘适配器发 驱动器号、圆柱面号（磁道）、磁头号、起始扇区、扇区数——统称为寻址信息
2. 磁盘适配器启动寻道、判断寻道是否正确（中断方式进行查询）
3. 准备完毕（缓冲读满一扇区/缓冲空出一扇区）提出DMA请求
4. CPU响应，总线权交DMA控制器，主存和磁盘直传
5. 磁盘适配器申请中断